#!/usr/bin/env ruby

require 'ideeli_spinup'
require 'logger'
require 'pp'
require 'yaml'
require 'optparse'
require 'rubygems'
require 'fog'


logger = Logger.new $stdout
logger.level = Logger::DEBUG

config = YAML.load_file('config/ideeli_spinup.yaml')
options = { :account           => nil,
            :region            => 'us-east-1',
            :availability_zone => nil,
            :image             => 'lucid64',
            :instance_type     => nil,
            :subnet            => nil,
            :security_group    => 'default',
            :logger            => logger }

hostnames = %w[foo.bar.com foo10.bar.com]

env = IdeeliSpinup::Environment.new(config, options)

logger.debug env.availability_zones
logger.debug sprintf( "Image: %s", env.image_from_name(options[:image]) )
logger.debug sprintf("default account: %s", env.default_account_name)

hostnames.each do |hostname|
  s = IdeeliSpinup::Server.new(hostname, env, :logger => logger )
  logger.debug sprintf("Hostname: %s, AZ: %s", s.hostname, s.availability_zone)
end 
